// Generated by CoffeeScript 1.7.1
var User, americano, helpers, timezones,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

americano = require('americano-cozy');

helpers = require('../lib/helpers');

timezones = require('../lib/timezones');

module.exports = User = americano.getModel('User', {
  email: String,
  password: String,
  salt: String,
  public_name: String,
  timezone: String,
  owner: Boolean,
  activated: Boolean
});

User.first = function(callback) {
  return User.request('all', function(err, users) {
    if (err) {
      return callback(new err);
    } else if (!users || users.length === 0) {
      return callback(null, null);
    } else {
      return callback(null, users[0]);
    }
  });
};

User.validate = function(data) {
  var errors, _ref;
  errors = [];
  errors = errors.concat(User.validatePassword(data.password));
  if (!helpers.checkEmail(data.email)) {
    errors.push('Invalid email format');
  }
  if (!(_ref = data.timezone, __indexOf.call(timezones, _ref) >= 0)) {
    errors.push('Invalid timezone');
  }
  return errors;
};

User.validatePassword = function(password) {
  var errors;
  errors = [];
  if ((password == null) || password.length < 5) {
    errors.push('Password is too short');
  }
  return errors;
};
